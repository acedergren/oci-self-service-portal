---
phase: 10-foundation-rewrite
plan: 13
type: execute
wave: 10
depends_on:
  - 10-05
  - 10-09
  - 10-12
files_modified:
  - apps/frontend/src/lib/components/workflows/nodes/AIStepNode.svelte
  - apps/frontend/src/lib/components/workflows/nodes/LoopNode.svelte
  - apps/frontend/src/lib/components/workflows/nodes/ParallelNode.svelte
  - apps/frontend/src/lib/components/workflows/NodeProperties.svelte
  - apps/frontend/src/lib/components/workflows/WorkflowCanvas.svelte
  - apps/frontend/src/tests/phase10/workflow-designer.test.ts
  - apps/frontend/src/tests/phase10/workflow-execution.test.ts
autonomous: true
must_haves:
  truths:
    - 'Designer UI exposes configuration for AI Step, Loop, Parallel nodes with validation.'
    - 'Retry, concurrency, and compensation options map to backend schema.'
    - 'Frontend tests verify node configuration, serialization, and execution triggers.'
  artifacts:
    - path: 'apps/frontend/src/lib/components/workflows/nodes/AIStepNode.svelte'
      provides: 'UI for AI step configuration'
    - path: 'apps/frontend/src/lib/components/workflows/nodes/LoopNode.svelte'
      provides: 'Loop node configuration UI'
    - path: 'apps/frontend/src/tests/phase10/workflow-designer.test.ts'
      provides: 'Designer regression tests'
  key_links:
    - from: 'apps/frontend/src/lib/components/workflows/NodeProperties.svelte'
      to: '@portal/types/workflows'
      via: 'import'
      pattern: '@portal/types/workflows'
    - from: 'apps/frontend/src/lib/components/workflows/WorkflowCanvas.svelte'
      to: 'apps/frontend/src/lib/components/workflows/nodes/ParallelNode.svelte'
      via: 'render'
      pattern: 'ParallelNode'
---

<objective>
Finish the workflow designer UI so all node types can be configured, retries/concurrency/compensation options are available, and execution integrates with the enhanced backend.

Purpose: Deliver PRD user story US-3 and set up admin observability work.
Output: Updated Svelte components and regression tests.
</objective>

<execution_context>
@/Users/acedergr/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/acedergr/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.claude/reference/PRD.md
@apps/frontend/src/lib/components/workflows/NodeProperties.svelte
</context>

<tasks>

<task type="auto">
  <name>Implement AI Step node configuration UI</name>
  <files>apps/frontend/src/lib/components/workflows/nodes/AIStepNode.svelte</files>
  <action>
  - Expose model selection, prompt template editor, and output schema builder referencing `@portal/types` definitions.
  - Validate required fields and show inline errors.
  - Ensure node serialization matches backend expectations.
  </action>
  <verify>pnpm --filter @portal/frontend lint</verify>
  <done>AI Step node UI captures required configuration with no lint errors.</done>
</task>

<task type="auto">
  <name>Enhance Loop and Parallel node UIs</name>
  <files>apps/frontend/src/lib/components/workflows/nodes/LoopNode.svelte</files>
  <action>
  - Add concurrency toggle for Loop nodes, binding to workflow schema.
  - For Parallel nodes, support branch naming and result mapping.
  - Update `NodeProperties.svelte` and `WorkflowCanvas.svelte` to surface new controls and preview aggregated outputs.
  </action>
  <verify>pnpm --filter @portal/frontend lint</verify>
  <done>Loop and Parallel node UIs expose new configuration options and compile cleanly.</done>
</task>

<task type="auto">
  <name>Add workflow designer regression tests</name>
  <files>apps/frontend/src/tests/phase10/workflow-designer.test.ts</files>
  <action>
  - Create Vitest + Svelte testing lib coverage verifying AI/Loop/Parallel nodes serialize correctly, retries/concurrency toggles persist, and compensation matches backend schema.
  - Add execution tests in `workflow-execution.test.ts` to assert the designer triggers API calls and handles streaming events.
  </action>
  <verify>pnpm --filter @portal/frontend test --run tests/phase10/workflow-designer.test.ts tests/phase10/workflow-execution.test.ts</verify>
  <done>Frontend tests cover new node configuration and execution flows.</done>
</task>

</tasks>

<verification>
- `pnpm --filter @portal/frontend lint`
- `pnpm --filter @portal/frontend test --run tests/phase10/workflow-designer.test.ts tests/phase10/workflow-execution.test.ts`
</verification>

<success_criteria>

- Designer UI supports AI, Loop, Parallel nodes with retries/concurrency/compensation options and passing tests.
  </success_criteria>

<output>
After completion, create `.planning/phases/10-foundation-rewrite/10-13-SUMMARY.md`
</output>
