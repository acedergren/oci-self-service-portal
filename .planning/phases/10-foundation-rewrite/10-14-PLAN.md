---
phase: 10-foundation-rewrite
plan: 14
type: execute
wave: 11
depends_on:
  - 10-08
files_modified:
  - packages/server/src/oracle/migrations/015-26ai.sql
  - packages/server/src/oracle/migrations/index.ts
  - packages/server/src/oracle/vector-index.ts
autonomous: true
must_haves:
  truths:
    - 'Oracle migration introduces HNSW DML vector indexes and VPD policies for tenant isolation.'
    - 'Vector bindings use DB_TYPE_VECTOR with Float32Array data.'
  artifacts:
    - path: 'packages/server/src/oracle/migrations/015-26ai.sql'
      provides: 'Oracle schema upgrades for 26AI'
    - path: 'packages/server/src/oracle/vector-index.ts'
      provides: 'Helpers to manage HNSW indexes'
  key_links:
    - from: 'packages/server/src/oracle/migrations/index.ts'
      to: '015-26ai.sql'
      via: 'migrations.push'
      pattern: '015-26ai'
---

<objective>
Apply Oracle 26AI enhancements—HNSW DML indexes, VPD policies, and native vector bindings—to meet PRD performance and isolation goals.

Purpose: Improve vector search latency and enforce tenant isolation at the database layer.
Output: New migration, updated vector helpers, and regression tests.
</objective>

<execution_context>
@/Users/acedergr/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/acedergr/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.claude/reference/PRD.md
@packages/server/src/mastra/rag/oracle-vector-store.ts
</context>

<tasks>

<task type="auto">
  <name>Write Oracle 26AI migration</name>
  <files>packages/server/src/oracle/migrations/015-26ai.sql</files>
  <action>
  - Create migration adding HNSW DML indexes, JSON relational duality views, and VPD policies for org isolation.
  - Ensure migration is idempotent and includes rollback statements where possible.
  - Register migration in `migrations/index.ts`.
  </action>
  <verify>pnpm --filter @portal/server build</verify>
  <done>Migration script compiled and registered.</done>
</task>

<task type="auto">
  <name>Update vector index helpers</name>
  <files>packages/server/src/oracle/vector-index.ts</files>
  <action>
  - Modify helper functions to create/configure HNSW indexes and to use `DB_TYPE_VECTOR` for Float32Array parameters.
  - Remove any string-based conversion utilities.
  </action>
  <verify>pnpm --filter @portal/server build</verify>
  <done>Vector index helpers support HNSW creation and typed bindings.</done>
</task>

</tasks>

<verification>
- `pnpm --filter @portal/server build`
</verification>

<success_criteria>

- Oracle schema includes HNSW indexes and VPD policies with typed bindings ready for integration tests.
  </success_criteria>

<output>
After completion, create `.planning/phases/10-foundation-rewrite/10-14-SUMMARY.md`
</output>
