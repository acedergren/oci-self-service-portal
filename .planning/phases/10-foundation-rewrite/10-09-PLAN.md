---
phase: 10-foundation-rewrite
plan: 09
type: execute
wave: 6
depends_on:
  - 10-08
files_modified:
  - packages/ui/package.json
  - packages/ui/tsconfig.json
  - packages/ui/src/index.ts
  - packages/ui/src/components/portal/PortalHeader.svelte
  - packages/ui/src/stores/ui.ts
  - packages/shared/src/components/index.ts
  - packages/shared/src/stores/ui.ts
  - apps/frontend/package.json
  - apps/frontend/tsconfig.json
autonomous: true
must_haves:
  truths:
    - "@portal/ui contains Svelte components, stores, and utilities separated from shared/server code."
    - "Frontend imports UI primitives from @portal/ui."
    - "Frontend build/test succeed after the split."
  artifacts:
    - path: "packages/ui/package.json"
      provides: "UI package manifest"
    - path: "packages/ui/src/index.ts"
      provides: "Exports for Svelte components and stores"
    - path: "apps/frontend/package.json"
      provides: "Frontend dependency list referencing @portal/ui"
  key_links:
    - from: "apps/frontend/src/lib/components/portal/index.ts"
      to: "@portal/ui"
      via: "import"
      pattern: "@portal/ui"
    - from: "packages/ui/src/index.ts"
      to: "packages/ui/src/components/portal/PortalHeader.svelte"
      via: "export"
      pattern: "export \* from './components/portal'"
---

<objective>
Extract UI components and stores into `@portal/ui`, leaving `@portal/shared` free of Svelte dependencies and updating frontend imports accordingly.

Purpose: Complete the package split mandated by the PRD, enabling independent publishing and faster builds.
Output: `@portal/ui` package, updated imports, and passing frontend build/tests.
</objective>

<execution_context>
@/Users/acedergr/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/acedergr/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.claude/reference/PRD.md
@apps/frontend/src/lib/components/portal/index.ts
</context>

<tasks>

<task type="auto">
  <name>Scaffold @portal/ui package and move components</name>
  <files>packages/ui/package.json</files>
  <action>
  - Create `packages/ui` with Svelte-ready `package.json` and `tsconfig.json` referencing Svelte 5.
  - Move components, stores, and utilities from `packages/shared/src` (UI-related) into `packages/ui/src` while preserving directory structure.
  - Configure `packages/ui/src/index.ts` to export components and stores for consumption.
  </action>
  <verify>pnpm --filter @portal/ui build</verify>
  <done>`@portal/ui` builds successfully with moved UI assets.</done>
</task>

<task type="auto">
  <name>Point frontend workspace to @portal/ui</name>
  <files>apps/frontend/package.json</files>
  <action>
  - Update frontend dependencies to consume `@portal/ui` (and drop direct imports from `@portal/shared` UI modules).
  - Adjust imports throughout `apps/frontend/src/lib/**` to the new package namespace.
  - Update Svelte configuration (vite, tsconfig) to locate the package's Svelte entrypoints.
  </action>
  <verify>
    pnpm --filter @portal/frontend lint
    pnpm --filter @portal/frontend test
    pnpm --filter @portal/frontend build
  </verify>
  <done>Frontend workspace builds/tests against `@portal/ui` imports.</done>
</task>

<task type="auto">
  <name>Clean leftovers from @portal/shared</name>
  <files>packages/shared/src/components/index.ts</files>
  <action>
  - Remove UI exports from `@portal/shared`, ensuring remaining modules are non-UI utilities.
  - Update documentation/comments to direct consumers to `@portal/ui`.
  - Confirm `pnpm --filter @portal/shared build` succeeds without Svelte dependencies.
  </action>
  <verify>pnpm --filter @portal/shared build</verify>
  <done>`@portal/shared` builds without Svelte dependencies or UI exports.</done>
</task>

</tasks>

<verification>
- `pnpm --filter @portal/ui build`
- `pnpm --filter @portal/frontend lint`
- `pnpm --filter @portal/frontend test`
- `pnpm --filter @portal/frontend build`
- `pnpm --filter @portal/shared build`
</verification>

<success_criteria>

- UI components reside in `@portal/ui`, and frontend builds/tests use the new package without regression.
- Shared package free of Svelte dependencies.
  </success_criteria>

<output>
After completion, create `.planning/phases/10-foundation-rewrite/10-09-SUMMARY.md`
</output>
